#!/bin/sh

set -e

if [ "$1" = "configure" ]; then
    # 创建用户
    if ! getent passwd crates-proxy >/dev/null; then
        adduser --system --group --home /var/lib/crates_proxy --no-create-home crates-proxy
    fi

    # 创建目录
    mkdir -p /var/lib/crates_proxy/cache
    chown crates-proxy:crates-proxy /var/lib/crates_proxy /var/lib/crates_proxy/cache
    chmod 750 /var/lib/crates_proxy /var/lib/crates_proxy/cache

    # 如果配置文件不存在，创建默认配置
    if [ ! -f /etc/crates_proxy/config.toml ]; then
        cp /usr/share/doc/crates-proxy/examples/config.toml.example /etc/crates_proxy/config.toml
        chown root:root /etc/crates_proxy/config.toml
        chmod 644 /etc/crates_proxy/config.toml
    fi
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0